<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <!-- Pure black background -->
  <rect width="900" height="600" fill="#000000"/>

  <!-- Title -->
  <text x="450" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">Layer Normalization on 3D Tensor</text>

  <!-- Subtitle -->
  <text x="450" y="60" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Shape: (batch=2, seq=3, features=4) — normalizes over the feature dimension
  </text>

  <!-- ============ 3D Input Visualization ============ -->
  <g transform="translate(40, 90)">
    <text x="100" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#888888" text-anchor="middle">Input 3D Tensor</text>

    <!-- Batch 1 (back layer - draw first so it's behind) -->
    <g transform="translate(20, 10)">
      <text x="170" y="10" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#555555" text-anchor="start">b[1]</text>

      <!-- 3x4 grid (dimmed) -->
      <g transform="translate(0, 0)">
        <rect x="0" y="0" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="42" y="0" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="84" y="0" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="126" y="0" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>

        <rect x="0" y="32" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="42" y="32" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="84" y="32" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="126" y="32" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>

        <rect x="0" y="64" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="42" y="64" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="84" y="64" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="126" y="64" width="40" height="30" fill="#111111" stroke="#333333" stroke-width="1"/>
      </g>
    </g>

    <!-- Connecting lines from front to back (correct direction) -->
    <g transform="translate(0, 25)">
      <line x1="0" y1="0" x2="20" y2="-15" stroke="#333333" stroke-width="1"/>
      <line x1="166" y1="0" x2="186" y2="-15" stroke="#333333" stroke-width="1"/>
      <line x1="0" y1="94" x2="20" y2="79" stroke="#333333" stroke-width="1"/>
      <line x1="166" y1="94" x2="186" y2="79" stroke="#333333" stroke-width="1"/>
    </g>

    <!-- Batch 0 (front layer - draw second so it's in front) -->
    <g transform="translate(0, 25)">
      <text x="-10" y="55" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666" text-anchor="end">b[0]</text>

      <!-- 3x4 grid -->
      <g transform="translate(0, 0)">
        <!-- Row 0 (seq 0) -->
        <rect x="0" y="0" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="20" y="20" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">10</text>
        <rect x="42" y="0" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="62" y="20" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">20</text>
        <rect x="84" y="0" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="104" y="20" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">30</text>
        <rect x="126" y="0" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="146" y="20" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">40</text>

        <!-- Row 1 (seq 1) -->
        <rect x="0" y="32" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="20" y="52" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">1</text>
        <rect x="42" y="32" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="62" y="52" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">2</text>
        <rect x="84" y="32" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="104" y="52" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">3</text>
        <rect x="126" y="32" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="146" y="52" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">4</text>

        <!-- Row 2 (seq 2) -->
        <rect x="0" y="64" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="20" y="84" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">0</text>
        <rect x="42" y="64" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="62" y="84" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">0</text>
        <rect x="84" y="64" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="104" y="84" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">8</text>
        <rect x="126" y="64" width="40" height="30" fill="#000000" stroke="#444444" stroke-width="1"/>
        <text x="146" y="84" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">0</text>
      </g>
    </g>

    <!-- Axis labels -->
    <text x="83" y="145" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#666666" text-anchor="middle">features (dim=2) →</text>
    <text x="-20" y="70" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#666666" text-anchor="middle" transform="rotate(-90, -20, 70)">seq (dim=1) ↓</text>
    <text x="200" y="20" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#666666" text-anchor="start">batch (dim=0) ↗</text>
  </g>

  <!-- ============ Arrow ============ -->
  <g transform="translate(250, 160)">
    <line x1="0" y1="0" x2="50" y2="0" stroke="#888888" stroke-width="2"/>
    <polygon points="50,0 43,-5 43,5" fill="#888888"/>
    <text x="25" y="-12" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FC6255" text-anchor="middle">LayerNorm</text>
  </g>

  <!-- ============ 3D Output Visualization ============ -->
  <g transform="translate(320, 90)">
    <text x="100" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FC6255" text-anchor="middle">Output 3D Tensor</text>

    <!-- Batch 0 (front layer) - with highlighted rows -->
    <g transform="translate(0, 25)">
      <!-- 3x4 grid with highlights -->
      <g transform="translate(0, 0)">
        <!-- Row 0 - highlighted -->
        <rect x="-5" y="-5" width="180" height="40" fill="#FC6255" fill-opacity="0.15" stroke="#FC6255" stroke-width="2"/>
        <rect x="0" y="0" width="40" height="30" fill="none" stroke="#FC6255" stroke-width="1"/>
        <text x="20" y="20" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-1.34</text>
        <rect x="42" y="0" width="40" height="30" fill="none" stroke="#FC6255" stroke-width="1"/>
        <text x="62" y="20" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-0.45</text>
        <rect x="84" y="0" width="40" height="30" fill="none" stroke="#FC6255" stroke-width="1"/>
        <text x="104" y="20" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">0.45</text>
        <rect x="126" y="0" width="40" height="30" fill="none" stroke="#FC6255" stroke-width="1"/>
        <text x="146" y="20" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">1.34</text>
        <text x="180" y="20" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167" text-anchor="start">μ=0 σ=1</text>

        <!-- Row 1 -->
        <rect x="-5" y="27" width="180" height="40" fill="#FC6255" fill-opacity="0.05"/>
        <rect x="0" y="32" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="20" y="52" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-1.34</text>
        <rect x="42" y="32" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="62" y="52" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-0.45</text>
        <rect x="84" y="32" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="104" y="52" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">0.45</text>
        <rect x="126" y="32" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="146" y="52" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">1.34</text>
        <text x="180" y="52" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167" text-anchor="start">μ=0 σ=1</text>

        <!-- Row 2 -->
        <rect x="-5" y="59" width="180" height="40" fill="#FC6255" fill-opacity="0.05"/>
        <rect x="0" y="64" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="20" y="84" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-0.58</text>
        <rect x="42" y="64" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="62" y="84" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-0.58</text>
        <rect x="84" y="64" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="104" y="84" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">1.73</text>
        <rect x="126" y="64" width="40" height="30" fill="none" stroke="#666666" stroke-width="1"/>
        <text x="146" y="84" font-family="monospace" font-size="9" fill="#FC6255" text-anchor="middle">-0.58</text>
        <text x="180" y="84" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167" text-anchor="start">μ=0 σ=1</text>
      </g>
    </g>

    <!-- Output shape note -->
    <text x="100" y="145" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="middle">Shape: (2, 3, 4) → (2, 3, 4)</text>
  </g>

  <!-- ============ The Key Concept ============ -->
  <g transform="translate(600, 90)">
    <rect x="0" y="0" width="280" height="130" fill="none" stroke="#444444" stroke-width="1"/>
    <text x="140" y="25" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#ffffff" text-anchor="middle">The Key Concept</text>

    <text x="20" y="55" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#FC6255" text-anchor="start">Each token's features</text>
    <text x="20" y="75" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#FC6255" text-anchor="start">are normalized independently</text>

    <text x="20" y="105" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="start">• Token 1: mean=0, std=1</text>
    <text x="20" y="120" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="start">• Token 2: mean=0, std=1</text>
  </g>

  <!-- ============ Visual: What gets normalized together ============ -->
  <g transform="translate(50, 260)">
    <text x="400" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#ffffff" text-anchor="middle">What Gets Normalized Together?</text>

    <!-- Single token extraction -->
    <g transform="translate(0, 30)">
      <!-- 3D tensor representation -->
      <g transform="translate(0, 0)">
        <text x="80" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">3D Tensor</text>

        <!-- Back layer (batch[1], faded) -->
        <rect x="25" y="25" width="130" height="75" fill="#111111" stroke="#333333" stroke-width="1"/>

        <!-- Front layer (batch[0]) -->
        <rect x="0" y="45" width="130" height="75" fill="#000000" stroke="#444444" stroke-width="1"/>

        <!-- Connecting lines front to back -->
        <line x1="0" y1="45" x2="25" y2="25" stroke="#333333" stroke-width="1"/>
        <line x1="130" y1="45" x2="155" y2="25" stroke="#333333" stroke-width="1"/>

        <!-- Highlight one row (one token) -->
        <rect x="0" y="65" width="130" height="20" fill="#FC6255" fill-opacity="0.3" stroke="#FC6255" stroke-width="2"/>

        <!-- Labels -->
        <text x="65" y="140" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666" text-anchor="middle">batch × seq × features</text>
      </g>

      <!-- Arrow -->
      <g transform="translate(160, 75)">
        <line x1="0" y1="0" x2="40" y2="0" stroke="#888888" stroke-width="2"/>
        <polygon points="40,0 33,-4 33,4" fill="#888888"/>
      </g>

      <!-- One token's features -->
      <g transform="translate(220, 50)">
        <text x="80" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FC6255" text-anchor="middle">One token's features</text>

        <rect x="0" y="15" width="35" height="30" fill="none" stroke="#FC6255" stroke-width="2"/>
        <text x="17" y="35" font-family="monospace" font-size="10" fill="#FC6255" text-anchor="middle">f₁</text>
        <rect x="40" y="15" width="35" height="30" fill="none" stroke="#FC6255" stroke-width="2"/>
        <text x="57" y="35" font-family="monospace" font-size="10" fill="#FC6255" text-anchor="middle">f₂</text>
        <rect x="80" y="15" width="35" height="30" fill="none" stroke="#FC6255" stroke-width="2"/>
        <text x="97" y="35" font-family="monospace" font-size="10" fill="#FC6255" text-anchor="middle">f₃</text>
        <rect x="120" y="15" width="35" height="30" fill="none" stroke="#FC6255" stroke-width="2"/>
        <text x="137" y="35" font-family="monospace" font-size="10" fill="#FC6255" text-anchor="middle">f₄</text>

        <text x="80" y="70" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="middle">This vector gets μ=0, σ=1</text>
      </g>

      <!-- Comparison with BatchNorm -->
      <g transform="translate(500, 0)">
        <text x="150" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">Compare: BatchNorm</text>

        <!-- 3D tensor with correct orientation -->
        <rect x="100" y="25" width="100" height="70" fill="#111111" stroke="#333333" stroke-width="1"/>
        <rect x="75" y="45" width="100" height="70" fill="#000000" stroke="#444444" stroke-width="1"/>

        <!-- Connecting lines front to back -->
        <line x1="75" y1="45" x2="100" y2="25" stroke="#333333" stroke-width="1"/>
        <line x1="175" y1="45" x2="200" y2="25" stroke="#333333" stroke-width="1"/>

        <!-- Highlight column (one feature across batch+seq) -->
        <rect x="95" y="25" width="20" height="90" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00" stroke-width="2"/>

        <text x="150" y="140" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FFFF00" text-anchor="middle">Normalizes across batch</text>
        <text x="150" y="155" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666" text-anchor="middle">(rarely used in transformers)</text>
      </g>
    </g>
  </g>

  <!-- ============ Code Example ============ -->
  <g transform="translate(50, 470)">
    <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#666666" text-anchor="start">PyTorch:</text>
    <text x="0" y="25" font-family="monospace" font-size="12" fill="#29ABCA" text-anchor="start">x = torch.randn(2, 3, 4)       # (batch, seq, features)</text>
    <text x="0" y="50" font-family="monospace" font-size="12" fill="#FC6255" text-anchor="start">y = nn.LayerNorm(4)(x)         # shape: (2, 3, 4) ← same!</text>
    <text x="0" y="75" font-family="monospace" font-size="12" fill="#888888" text-anchor="start"># Each of the 2×3=6 tokens now has mean=0, std=1</text>
  </g>

  <!-- ============ Why LayerNorm in Transformers ============ -->
  <g transform="translate(500, 470)">
    <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#666666" text-anchor="start">Why LayerNorm in Transformers?</text>
    <text x="0" y="25" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="start">• Works with variable sequence lengths</text>
    <text x="0" y="45" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="start">• Each token normalized independently</text>
    <text x="0" y="65" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="start">• No batch statistics needed at inference</text>
  </g>
</svg>