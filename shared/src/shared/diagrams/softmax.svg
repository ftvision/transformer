<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <defs>
    <!-- 3b1b-style gradients -->
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16a34a;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7c3aed;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="redGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#dc2626;stop-opacity:1" />
    </linearGradient>

    <!-- Background gradient -->
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#1a1a2e;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#16213e;stop-opacity:1" />
    </linearGradient>

    <!-- Glow filter -->
    <filter id="glow">
      <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>

    <!-- Arrow marker -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="600" fill="url(#bgGrad)"/>

  <!-- Title -->
  <text x="450" y="35" font-family="Georgia, serif" font-size="26" fill="#f1f5f9" text-anchor="middle" font-weight="bold">Softmax: Converting Scores to Probabilities</text>

  <!-- Formula with stability trick highlighted -->
  <text x="450" y="65" font-family="Georgia, serif" font-size="15" fill="#94a3b8" text-anchor="middle">
    <tspan fill="#ef4444">Stable:</tspan> softmax(x) = exp(x - max(x)) / Σ exp(x - max(x))
  </text>

  <!-- ============ STEP 1: Input ============ -->
  <g transform="translate(30, 100)">
    <text x="70" y="0" font-family="Georgia, serif" font-size="15" fill="#cbd5e1" text-anchor="middle" font-weight="bold">Input</text>

    <g transform="translate(0, 20)">
      <rect x="10" y="40" width="35" height="80" rx="4" fill="url(#blueGrad)" filter="url(#glow)"/>
      <text x="27" y="135" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">2.0</text>

      <rect x="55" y="80" width="35" height="40" rx="4" fill="url(#greenGrad)" filter="url(#glow)"/>
      <text x="72" y="135" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">1.0</text>

      <rect x="100" y="112" width="35" height="8" rx="4" fill="url(#purpleGrad)" filter="url(#glow)"/>
      <text x="117" y="135" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">0.1</text>
    </g>

    <text x="70" y="175" font-family="Georgia, serif" font-size="11" fill="#64748b" text-anchor="middle">max = 2.0</text>
  </g>

  <!-- Arrow 1 -->
  <g transform="translate(160, 170)">
    <line x1="0" y1="0" x2="50" y2="0" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="25" y="-8" font-family="Georgia, serif" font-size="10" fill="#ef4444" text-anchor="middle" font-weight="bold">- max(x)</text>
  </g>

  <!-- ============ STEP 2: Shifted (Stability Trick) ============ -->
  <g transform="translate(220, 100)">
    <text x="70" y="0" font-family="Georgia, serif" font-size="15" fill="#ef4444" text-anchor="middle" font-weight="bold">Shifted</text>
    <text x="70" y="15" font-family="Georgia, serif" font-size="10" fill="#ef4444" text-anchor="middle">(stability trick)</text>

    <g transform="translate(0, 25)">
      <!-- Zero reference line -->
      <line x1="5" y1="120" x2="140" y2="120" stroke="#64748b" stroke-width="1" stroke-dasharray="3,2"/>
      <text x="145" y="123" font-family="monospace" font-size="9" fill="#64748b">0</text>

      <!-- Shifted bars (relative to 0) -->
      <rect x="10" y="120" width="35" height="0" rx="4" fill="url(#blueGrad)" filter="url(#glow)"/>
      <circle cx="27" cy="120" r="4" fill="#3b82f6"/>
      <text x="27" y="140" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">0.0</text>

      <rect x="55" y="120" width="35" height="25" rx="4" fill="url(#greenGrad)" filter="url(#glow)" transform="scale(1,-1) translate(0,-240)"/>
      <text x="72" y="140" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">-1.0</text>

      <rect x="100" y="120" width="35" height="48" rx="4" fill="url(#purpleGrad)" filter="url(#glow)" transform="scale(1,-1) translate(0,-240)"/>
      <text x="117" y="140" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">-1.9</text>
    </g>

    <!-- Highlight box -->
    <rect x="-5" y="20" width="150" height="140" rx="8" fill="none" stroke="#ef4444" stroke-width="2" stroke-dasharray="5,3" opacity="0.5"/>
  </g>

  <!-- Arrow 2 -->
  <g transform="translate(370, 170)">
    <line x1="0" y1="0" x2="50" y2="0" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="25" y="-8" font-family="Georgia, serif" font-size="10" fill="#94a3b8" text-anchor="middle">exp(x)</text>
  </g>

  <!-- ============ STEP 3: Exponentials ============ -->
  <g transform="translate(430, 100)">
    <text x="70" y="0" font-family="Georgia, serif" font-size="15" fill="#cbd5e1" text-anchor="middle" font-weight="bold">Exponentials</text>

    <g transform="translate(0, 20)">
      <!-- exp(0) = 1.0, exp(-1) ≈ 0.37, exp(-1.9) ≈ 0.15 -->
      <rect x="10" y="20" width="35" height="100" rx="4" fill="url(#blueGrad)" opacity="0.8" filter="url(#glow)"/>
      <text x="27" y="135" font-family="monospace" font-size="11" fill="#94a3b8" text-anchor="middle">1.00</text>

      <rect x="55" y="83" width="35" height="37" rx="4" fill="url(#greenGrad)" opacity="0.8" filter="url(#glow)"/>
      <text x="72" y="135" font-family="monospace" font-size="11" fill="#94a3b8" text-anchor="middle">0.37</text>

      <rect x="100" y="105" width="35" height="15" rx="4" fill="url(#purpleGrad)" opacity="0.8" filter="url(#glow)"/>
      <text x="117" y="135" font-family="monospace" font-size="11" fill="#94a3b8" text-anchor="middle">0.15</text>
    </g>

    <text x="70" y="175" font-family="Georgia, serif" font-size="11" fill="#94a3b8" text-anchor="middle">sum = 1.52</text>
  </g>

  <!-- Arrow 3 -->
  <g transform="translate(580, 170)">
    <line x1="0" y1="0" x2="50" y2="0" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="25" y="-8" font-family="Georgia, serif" font-size="10" fill="#94a3b8" text-anchor="middle">÷ sum</text>
  </g>

  <!-- ============ STEP 4: Output Probabilities ============ -->
  <g transform="translate(640, 100)">
    <text x="90" y="0" font-family="Georgia, serif" font-size="15" fill="#cbd5e1" text-anchor="middle" font-weight="bold">Probabilities</text>

    <g transform="translate(0, 20)">
      <rect x="10" y="8" width="50" height="112" rx="4" fill="url(#blueGrad)" filter="url(#glow)"/>
      <text x="35" y="135" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle" font-weight="bold">0.659</text>
      <text x="35" y="152" font-family="Georgia, serif" font-size="10" fill="#64748b" text-anchor="middle">65.9%</text>

      <rect x="70" y="79" width="50" height="41" rx="4" fill="url(#greenGrad)" filter="url(#glow)"/>
      <text x="95" y="135" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle" font-weight="bold">0.242</text>
      <text x="95" y="152" font-family="Georgia, serif" font-size="10" fill="#64748b" text-anchor="middle">24.2%</text>

      <rect x="130" y="103" width="50" height="17" rx="4" fill="url(#purpleGrad)" filter="url(#glow)"/>
      <text x="155" y="135" font-family="monospace" font-size="13" fill="#f1f5f9" text-anchor="middle" font-weight="bold">0.099</text>
      <text x="155" y="152" font-family="Georgia, serif" font-size="10" fill="#64748b" text-anchor="middle">9.9%</text>
    </g>

    <!-- Sum = 1 checkmark -->
    <g transform="translate(20, 170)">
      <rect x="0" y="0" width="140" height="25" rx="12" fill="none" stroke="#22c55e" stroke-width="2"/>
      <text x="70" y="17" font-family="Georgia, serif" font-size="13" fill="#22c55e" text-anchor="middle">Σ = 1.000 ✓</text>
    </g>
  </g>

  <!-- ============ WHY STABILITY MATTERS ============ -->
  <g transform="translate(50, 320)">
    <rect x="0" y="0" width="800" height="130" rx="10" fill="#1e293b" stroke="#ef4444" stroke-width="2"/>

    <text x="400" y="25" font-family="Georgia, serif" font-size="16" fill="#ef4444" text-anchor="middle" font-weight="bold">Why Subtract max(x)?  —  Numerical Stability</text>

    <!-- Without trick (overflow) -->
    <g transform="translate(50, 45)">
      <text x="150" y="0" font-family="Georgia, serif" font-size="13" fill="#cbd5e1" text-anchor="middle" font-weight="bold">Without the trick:</text>
      <text x="150" y="22" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">x = [1000, 1001, 1002]</text>
      <text x="150" y="42" font-family="monospace" font-size="12" fill="#ef4444" text-anchor="middle">exp(1000) = inf ❌</text>
      <text x="150" y="62" font-family="Georgia, serif" font-size="11" fill="#64748b" text-anchor="middle">Overflow! Result is NaN</text>
    </g>

    <!-- With trick (safe) -->
    <g transform="translate(450, 45)">
      <text x="150" y="0" font-family="Georgia, serif" font-size="13" fill="#cbd5e1" text-anchor="middle" font-weight="bold">With the trick:</text>
      <text x="150" y="22" font-family="monospace" font-size="12" fill="#94a3b8" text-anchor="middle">x - max = [-2, -1, 0]</text>
      <text x="150" y="42" font-family="monospace" font-size="12" fill="#22c55e" text-anchor="middle">exp(0) = 1.0 ✓</text>
      <text x="150" y="62" font-family="Georgia, serif" font-size="11" fill="#64748b" text-anchor="middle">Safe! Same result mathematically</text>
    </g>
  </g>

  <!-- ============ KEY INSIGHT ============ -->
  <g transform="translate(50, 470)">
    <rect x="0" y="0" width="800" height="110" rx="10" fill="#1e293b" stroke="#334155" stroke-width="1"/>

    <text x="400" y="25" font-family="Georgia, serif" font-size="16" fill="#f1f5f9" text-anchor="middle" font-weight="bold">Key Properties</text>

    <g transform="translate(80, 45)">
      <circle cx="0" cy="8" r="4" fill="#3b82f6"/>
      <text x="15" y="12" font-family="Georgia, serif" font-size="13" fill="#94a3b8">Preserves relative ordering (highest input → highest probability)</text>
    </g>

    <g transform="translate(80, 70)">
      <circle cx="0" cy="8" r="4" fill="#22c55e"/>
      <text x="15" y="12" font-family="Georgia, serif" font-size="13" fill="#94a3b8">Outputs are valid probabilities (positive, sum to 1)</text>
    </g>

    <g transform="translate(80, 95)">
      <circle cx="0" cy="8" r="4" fill="#ef4444"/>
      <text x="15" y="12" font-family="Georgia, serif" font-size="13" fill="#94a3b8">softmax(x) = softmax(x - c) for any constant c (shift invariant)</text>
    </g>
  </g>
</svg>