<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 650">
  <!-- Pure black background -->
  <rect width="800" height="650" fill="#000000"/>

  <!-- Title -->
  <text x="400" y="30" font-family="CMU Serif, Georgia, serif" font-size="22" fill="#ffffff" text-anchor="middle">GPT Architecture</text>
  <text x="400" y="50" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="middle">
    Decoder-Only Transformer with Pre-Layer Norm
  </text>

  <!-- ============ Main Flow ============ -->

  <!-- Input Tokens -->
  <g transform="translate(350, 70)">
    <rect x="0" y="0" width="100" height="30" rx="5" fill="none" stroke="#666666" stroke-width="1"/>
    <text x="50" y="20" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="middle">Input Tokens</text>
  </g>

  <!-- Arrow -->
  <line x1="400" y1="100" x2="400" y2="115" stroke="#666666" stroke-width="1"/>
  <polygon points="400,120 396,113 404,113" fill="#666666"/>

  <!-- Token + Position Embedding -->
  <g transform="translate(280, 125)">
    <rect x="0" y="0" width="240" height="45" rx="6" fill="#83C167" fill-opacity="0.15" stroke="#83C167" stroke-width="1.5"/>
    <text x="120" y="20" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">Token Embedding + Positional Embedding</text>
    <text x="120" y="36" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">[vocab_size, d_model] + [max_len, d_model]</text>
  </g>

  <!-- Arrow -->
  <line x1="400" y1="170" x2="400" y2="185" stroke="#666666" stroke-width="1"/>
  <polygon points="400,190 396,183 404,183" fill="#666666"/>

  <!-- ============ Transformer Block (detailed) ============ -->
  <g transform="translate(180, 195)">
    <rect x="0" y="0" width="440" height="300" rx="10" fill="none" stroke="#FFFF00" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="220" y="-8" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FFFF00" text-anchor="middle">Transformer Block × N</text>

    <!-- Layer Norm 1 -->
    <g transform="translate(160, 25)">
      <rect x="0" y="0" width="120" height="30" rx="4" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-width="1"/>
      <text x="60" y="19" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">LayerNorm</text>
    </g>

    <!-- Arrow -->
    <line x1="220" y1="55" x2="220" y2="70" stroke="#666666" stroke-width="1"/>
    <polygon points="220,75 216,68 224,68" fill="#666666"/>

    <!-- Multi-Head Self-Attention -->
    <g transform="translate(110, 80)">
      <rect x="0" y="0" width="220" height="70" rx="6" fill="#FFFF00" fill-opacity="0.15" stroke="#FFFF00" stroke-width="1.5"/>
      <text x="110" y="25" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FFFF00" text-anchor="middle">Multi-Head Self-Attention</text>
      <text x="110" y="42" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="middle">Causal Mask Applied</text>
      <text x="110" y="58" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">Q, K, V projections → Attention → Output</text>
    </g>

    <!-- Residual connection 1 (left bypass) -->
    <path d="M 80,12 L 80,165 L 160,165" stroke="#FF6B6B" stroke-width="1" fill="none" stroke-dasharray="3,2"/>
    <text x="75" y="90" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FF6B6B" text-anchor="end" transform="rotate(-90, 75, 90)">+ residual</text>

    <!-- Arrow + residual connection -->
    <line x1="220" y1="150" x2="220" y2="160" stroke="#666666" stroke-width="1"/>
    <circle cx="220" cy="165" r="8" fill="#222222" stroke="#FF6B6B"/>
    <text x="220" y="168" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#FF6B6B" text-anchor="middle">+</text>

    <!-- Arrow -->
    <line x1="220" y1="175" x2="220" y2="185" stroke="#666666" stroke-width="1"/>
    <polygon points="220,190 216,183 224,183" fill="#666666"/>

    <!-- Layer Norm 2 -->
    <g transform="translate(160, 195)">
      <rect x="0" y="0" width="120" height="30" rx="4" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-width="1"/>
      <text x="60" y="19" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">LayerNorm</text>
    </g>

    <!-- Arrow -->
    <line x1="220" y1="225" x2="220" y2="238" stroke="#666666" stroke-width="1"/>
    <polygon points="220,243 216,236 224,236" fill="#666666"/>

    <!-- Feed Forward -->
    <g transform="translate(130, 248)">
      <rect x="0" y="0" width="180" height="35" rx="5" fill="#83C167" fill-opacity="0.15" stroke="#83C167" stroke-width="1"/>
      <text x="90" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="middle">Feed Forward (MLP)</text>
      <text x="90" y="28" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">Linear → GELU → Linear</text>
    </g>

    <!-- Residual connection 2 (right bypass) -->
    <path d="M 360,180 L 360,290 L 320,290" stroke="#FF6B6B" stroke-width="1" fill="none" stroke-dasharray="3,2"/>
    <text x="365" y="235" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FF6B6B" text-anchor="start" transform="rotate(90, 365, 235)">+ residual</text>

    <!-- Arrow + residual -->
    <circle cx="310" cy="290" r="8" fill="#222222" stroke="#FF6B6B"/>
    <text x="310" y="293" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#FF6B6B" text-anchor="middle">+</text>
  </g>

  <!-- Arrow out of block -->
  <line x1="400" y1="495" x2="400" y2="510" stroke="#666666" stroke-width="1"/>
  <polygon points="400,515 396,508 404,508" fill="#666666"/>

  <!-- Final Layer Norm -->
  <g transform="translate(320, 520)">
    <rect x="0" y="0" width="160" height="30" rx="4" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-width="1"/>
    <text x="80" y="19" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">Final LayerNorm</text>
  </g>

  <!-- Arrow -->
  <line x1="400" y1="550" x2="400" y2="565" stroke="#666666" stroke-width="1"/>
  <polygon points="400,570 396,563 404,563" fill="#666666"/>

  <!-- LM Head / Output Projection -->
  <g transform="translate(300, 575)">
    <rect x="0" y="0" width="200" height="35" rx="5" fill="#FF6B6B" fill-opacity="0.15" stroke="#FF6B6B" stroke-width="1.5"/>
    <text x="100" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FF6B6B" text-anchor="middle">LM Head (tied weights)</text>
    <text x="100" y="28" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">Linear: d_model → vocab_size</text>
  </g>

  <!-- Arrow -->
  <line x1="400" y1="610" x2="400" y2="620" stroke="#666666" stroke-width="1"/>
  <polygon points="400,625 396,618 404,618" fill="#666666"/>

  <!-- Output -->
  <g transform="translate(340, 628)">
    <rect x="0" y="0" width="120" height="22" rx="4" fill="none" stroke="#666666" stroke-width="1"/>
    <text x="60" y="15" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="middle">Logits / Softmax</text>
  </g>

  <!-- ============ Side Annotations ============ -->

  <!-- GPT-2 specs -->
  <g transform="translate(640, 195)">
    <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#ffffff">GPT-2 Small</text>
    <text x="0" y="20" font-family="monospace" font-size="9" fill="#888888">d_model = 768</text>
    <text x="0" y="35" font-family="monospace" font-size="9" fill="#888888">num_heads = 12</text>
    <text x="0" y="50" font-family="monospace" font-size="9" fill="#888888">num_layers = 12</text>
    <text x="0" y="65" font-family="monospace" font-size="9" fill="#888888">d_ff = 3072</text>
    <text x="0" y="80" font-family="monospace" font-size="9" fill="#888888">vocab = 50257</text>
    <text x="0" y="95" font-family="monospace" font-size="9" fill="#888888">max_seq = 1024</text>
  </g>

  <!-- Key insight box -->
  <g transform="translate(640, 330)">
    <rect x="0" y="0" width="140" height="90" rx="5" fill="#333333" stroke="#555555"/>
    <text x="70" y="18" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#ffffff" text-anchor="middle">Key Differences</text>
    <text x="10" y="38" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#29ABCA">• Pre-LN (vs Post-LN)</text>
    <text x="10" y="53" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FFFF00">• Causal masking</text>
    <text x="10" y="68" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FF6B6B">• Tied embeddings</text>
    <text x="10" y="83" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167">• GELU activation</text>
  </g>

  <!-- Legend -->
  <g transform="translate(30, 550)">
    <rect x="0" y="0" width="12" height="12" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00"/>
    <text x="18" y="10" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FFFF00">Self-Attention</text>

    <rect x="0" y="20" width="12" height="12" fill="#83C167" fill-opacity="0.3" stroke="#83C167"/>
    <text x="18" y="30" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167">Embedding/FFN</text>

    <rect x="0" y="40" width="12" height="12" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
    <text x="18" y="50" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#29ABCA">LayerNorm</text>

    <line x1="0" y1="66" x2="12" y2="66" stroke="#FF6B6B" stroke-width="1" stroke-dasharray="3,2"/>
    <text x="18" y="70" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FF6B6B">Residual</text>
  </g>
</svg>
