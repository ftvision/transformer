<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 550">
  <!-- Pure black background -->
  <rect width="800" height="550" fill="#000000"/>

  <!-- Title -->
  <text x="400" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">KV-Cache: Avoiding Redundant Computation</text>

  <!-- Subtitle -->
  <text x="400" y="60" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Cache K and V from previous tokens — only compute Q for new token
  </text>

  <!-- ============ Without KV-Cache ============ -->
  <g transform="translate(50, 90)">
    <text x="150" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FF6B6B" text-anchor="middle">Without KV-Cache (Naive)</text>

    <!-- Step 1 -->
    <g transform="translate(0, 25)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 1:</text>
      <rect x="60" y="0" width="30" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="75" y="17" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">t1</text>
    </g>

    <!-- Step 2 -->
    <g transform="translate(0, 55)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 2:</text>
      <rect x="60" y="0" width="30" height="25" fill="#FF6B6B" fill-opacity="0.2" stroke="#FF6B6B" stroke-dasharray="3,3"/>
      <text x="75" y="17" font-family="monospace" font-size="10" fill="#FF6B6B" text-anchor="middle">t1</text>
      <rect x="95" y="0" width="30" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="110" y="17" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">t2</text>
      <text x="145" y="17" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#FF6B6B">recomputed!</text>
    </g>

    <!-- Step 3 -->
    <g transform="translate(0, 85)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 3:</text>
      <rect x="60" y="0" width="30" height="25" fill="#FF6B6B" fill-opacity="0.2" stroke="#FF6B6B" stroke-dasharray="3,3"/>
      <text x="75" y="17" font-family="monospace" font-size="10" fill="#FF6B6B" text-anchor="middle">t1</text>
      <rect x="95" y="0" width="30" height="25" fill="#FF6B6B" fill-opacity="0.2" stroke="#FF6B6B" stroke-dasharray="3,3"/>
      <text x="110" y="17" font-family="monospace" font-size="10" fill="#FF6B6B" text-anchor="middle">t2</text>
      <rect x="130" y="0" width="30" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="145" y="17" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">t3</text>
    </g>

    <!-- Step N -->
    <g transform="translate(0, 120)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step N:</text>
      <rect x="60" y="0" width="180" height="25" fill="#FF6B6B" fill-opacity="0.2" stroke="#FF6B6B" stroke-dasharray="3,3"/>
      <text x="150" y="17" font-family="monospace" font-size="10" fill="#FF6B6B" text-anchor="middle">t1 ... t(N-1) all recomputed</text>
      <rect x="245" y="0" width="30" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="260" y="17" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">tN</text>
    </g>

    <!-- Complexity -->
    <text x="150" y="170" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">Total work: O(N²)</text>
  </g>

  <!-- ============ With KV-Cache ============ -->
  <g transform="translate(420, 90)">
    <text x="170" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#83C167" text-anchor="middle">With KV-Cache</text>

    <!-- Step 1 -->
    <g transform="translate(0, 25)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 1:</text>
      <text x="60" y="15" font-family="monospace" font-size="10" fill="#FFFF00">Q:</text>
      <rect x="80" y="0" width="25" height="25" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00"/>
      <text x="92" y="17" font-family="monospace" font-size="9" fill="#FFFF00" text-anchor="middle">Q1</text>
      <text x="115" y="15" font-family="monospace" font-size="10" fill="#29ABCA">Cache:</text>
      <rect x="160" y="0" width="25" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="172" y="17" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K1</text>
      <rect x="190" y="0" width="25" height="25" fill="#83C167" fill-opacity="0.3" stroke="#83C167"/>
      <text x="202" y="17" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V1</text>
    </g>

    <!-- Step 2 -->
    <g transform="translate(0, 55)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 2:</text>
      <text x="60" y="15" font-family="monospace" font-size="10" fill="#FFFF00">Q:</text>
      <rect x="80" y="0" width="25" height="25" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00"/>
      <text x="92" y="17" font-family="monospace" font-size="9" fill="#FFFF00" text-anchor="middle">Q2</text>
      <text x="115" y="15" font-family="monospace" font-size="10" fill="#29ABCA">Cache:</text>
      <rect x="160" y="0" width="25" height="25" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-dasharray="2,2"/>
      <rect x="190" y="0" width="25" height="25" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <rect x="220" y="0" width="25" height="25" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-dasharray="2,2"/>
      <rect x="250" y="0" width="25" height="25" fill="#83C167" fill-opacity="0.3" stroke="#83C167"/>
      <text x="300" y="17" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#83C167">+new</text>
    </g>

    <!-- Step 3 -->
    <g transform="translate(0, 85)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step 3:</text>
      <text x="60" y="15" font-family="monospace" font-size="10" fill="#FFFF00">Q:</text>
      <rect x="80" y="0" width="25" height="25" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00"/>
      <text x="92" y="17" font-family="monospace" font-size="9" fill="#FFFF00" text-anchor="middle">Q3</text>
      <text x="115" y="15" font-family="monospace" font-size="10" fill="#29ABCA">Cache:</text>
      <rect x="160" y="0" width="75" height="25" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-dasharray="2,2"/>
      <rect x="240" y="0" width="75" height="25" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-dasharray="2,2"/>
      <text x="197" y="17" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K1,K2,K3</text>
      <text x="277" y="17" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V1,V2,V3</text>
    </g>

    <!-- Step N -->
    <g transform="translate(0, 120)">
      <text x="0" y="15" font-family="monospace" font-size="11" fill="#666666">Step N:</text>
      <text x="60" y="15" font-family="monospace" font-size="10" fill="#FFFF00">Q:</text>
      <rect x="80" y="0" width="25" height="25" fill="#FFFF00" fill-opacity="0.3" stroke="#FFFF00"/>
      <text x="92" y="17" font-family="monospace" font-size="9" fill="#FFFF00" text-anchor="middle">QN</text>
      <text x="115" y="15" font-family="monospace" font-size="10" fill="#666666">Cache:</text>
      <rect x="160" y="0" width="80" height="25" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-dasharray="2,2"/>
      <rect x="245" y="0" width="80" height="25" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-dasharray="2,2"/>
      <text x="200" y="17" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K1..KN</text>
      <text x="285" y="17" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V1..VN</text>
    </g>

    <!-- Complexity -->
    <text x="170" y="170" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#83C167" text-anchor="middle">Total work: O(N)</text>
  </g>

  <!-- ============ Attention Operation Diagram ============ -->
  <g transform="translate(50, 320)">
    <text x="350" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#ffffff" text-anchor="middle">Attention with KV-Cache (Step 3)</text>

    <!-- Q vector -->
    <g transform="translate(50, 40)">
      <text x="15" y="-5" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FFFF00" text-anchor="middle">Q (new)</text>
      <rect x="0" y="0" width="30" height="80" fill="#FFFF00" fill-opacity="0.2" stroke="#FFFF00" stroke-width="2"/>
      <text x="15" y="45" font-family="monospace" font-size="10" fill="#FFFF00" text-anchor="middle">Q3</text>
      <text x="15" y="95" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">(1×d)</text>
    </g>

    <!-- Times symbol -->
    <text x="115" y="80" font-family="CMU Serif, Georgia, serif" font-size="20" fill="#888888" text-anchor="middle">×</text>

    <!-- K^T cached -->
    <g transform="translate(140, 40)">
      <text x="50" y="-5" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA" text-anchor="middle">K^T (cached)</text>
      <rect x="0" y="0" width="100" height="30" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA" stroke-width="2"/>
      <text x="20" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K1</text>
      <text x="50" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K2</text>
      <text x="80" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">K3</text>
      <text x="50" y="50" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">(d×3)</text>
    </g>

    <!-- Arrow -->
    <text x="275" y="80" font-family="CMU Serif, Georgia, serif" font-size="20" fill="#888888" text-anchor="middle">→</text>

    <!-- Attention scores -->
    <g transform="translate(305, 40)">
      <text x="50" y="-5" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="middle">Scores</text>
      <rect x="0" y="0" width="100" height="30" fill="#888888" fill-opacity="0.1" stroke="#888888"/>
      <text x="20" y="20" font-family="monospace" font-size="9" fill="#888888" text-anchor="middle">.5</text>
      <text x="50" y="20" font-family="monospace" font-size="9" fill="#888888" text-anchor="middle">.3</text>
      <text x="80" y="20" font-family="monospace" font-size="9" fill="#888888" text-anchor="middle">.2</text>
      <text x="50" y="50" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">(1×3)</text>
    </g>

    <!-- Times symbol -->
    <text x="440" y="80" font-family="CMU Serif, Georgia, serif" font-size="20" fill="#888888" text-anchor="middle">×</text>

    <!-- V cached -->
    <g transform="translate(465, 40)">
      <text x="15" y="-5" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">V (cached)</text>
      <rect x="0" y="0" width="30" height="80" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-width="2"/>
      <text x="15" y="25" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V1</text>
      <text x="15" y="45" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V2</text>
      <text x="15" y="65" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">V3</text>
      <text x="15" y="95" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">(3×d)</text>
    </g>

    <!-- Arrow -->
    <text x="530" y="80" font-family="CMU Serif, Georgia, serif" font-size="20" fill="#888888" text-anchor="middle">→</text>

    <!-- Output -->
    <g transform="translate(560, 40)">
      <text x="15" y="-5" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#ffffff" text-anchor="middle">Out</text>
      <rect x="0" y="0" width="30" height="80" fill="#ffffff" fill-opacity="0.1" stroke="#ffffff" stroke-width="2"/>
      <text x="15" y="45" font-family="monospace" font-size="10" fill="#ffffff" text-anchor="middle">O3</text>
      <text x="15" y="95" font-family="monospace" font-size="9" fill="#666666" text-anchor="middle">(1×d)</text>
    </g>

    <!-- Key insight -->
    <rect x="620" y="30" width="130" height="80" rx="5" fill="#FFFF00" fill-opacity="0.1" stroke="#FFFF00" stroke-width="1"/>
    <text x="685" y="55" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FFFF00" text-anchor="middle">Only Q is new</text>
    <text x="685" y="75" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FFFF00" text-anchor="middle">K, V from cache</text>
    <text x="685" y="95" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="middle">→ No recompute!</text>
  </g>

  <!-- ============ Memory Growth ============ -->
  <g transform="translate(50, 480)">
    <text x="350" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">Cache Memory: O(batch × seq_len × layers × 2 × d_model)</text>
    <text x="350" y="20" font-family="monospace" font-size="12" fill="#FF6B6B" text-anchor="middle">Llama-2-7B: ~512 KB per token → 2 GB for 4096 tokens</text>
  </g>
</svg>
