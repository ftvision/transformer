<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550">
  <defs>
    <style>
      .title { font-family: "CMU Serif", Georgia, serif; font-size: 24px; fill: #FFFFFF; }
      .subtitle { font-family: "CMU Serif", Georgia, serif; font-size: 14px; fill: #888888; }
      .label { font-family: "CMU Serif", Georgia, serif; font-size: 12px; fill: #FFFFFF; }
      .small-label { font-family: "CMU Serif", Georgia, serif; font-size: 10px; fill: #888888; }
      .math { font-family: "CMU Serif", Georgia, serif; font-size: 11px; fill: #FFFFFF; font-style: italic; }
      .dim { font-family: monospace; font-size: 9px; fill: #666666; }
      .box { stroke-width: 2; rx: 5; }
      .arrow { stroke: #666666; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666666"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#000000"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" class="title">Multi-head Latent Attention (MLA)</text>
  <text x="450" y="55" text-anchor="middle" class="subtitle">DeepSeek-V2: Compress K,V to shared latent, decompress on-the-fly</text>

  <!-- Standard MHA (left side) -->
  <g transform="translate(80, 100)">
    <text x="120" y="0" text-anchor="middle" class="label" fill="#FF6B6B">Standard MHA</text>

    <!-- Input X -->
    <rect x="80" y="20" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="120" y="40" text-anchor="middle" class="label" fill="#000000">X</text>
    <text x="120" y="60" text-anchor="middle" class="dim">(seq, d_model)</text>

    <!-- Three projections -->
    <path d="M100,50 L60,90" class="arrow"/>
    <path d="M120,50 L120,90" class="arrow"/>
    <path d="M140,50 L180,90" class="arrow"/>

    <!-- Q, K, V boxes -->
    <rect x="20" y="90" width="60" height="30" fill="#83C167" class="box" stroke="#83C167"/>
    <text x="50" y="110" text-anchor="middle" class="label" fill="#000000">Q</text>

    <rect x="90" y="90" width="60" height="30" fill="#FFFF00" class="box" stroke="#FFFF00"/>
    <text x="120" y="110" text-anchor="middle" class="label" fill="#000000">K</text>

    <rect x="160" y="90" width="60" height="30" fill="#FF9500" class="box" stroke="#FF9500"/>
    <text x="190" y="110" text-anchor="middle" class="label" fill="#000000">V</text>

    <!-- Dimension labels -->
    <text x="50" y="135" text-anchor="middle" class="dim">(seq, h×d)</text>
    <text x="120" y="135" text-anchor="middle" class="dim">(seq, h×d)</text>
    <text x="190" y="135" text-anchor="middle" class="dim">(seq, h×d)</text>

    <!-- Cache box -->
    <rect x="75" y="155" width="130" height="50" fill="none" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5,3" rx="5"/>
    <text x="140" y="175" text-anchor="middle" class="label" fill="#FF6B6B">KV Cache</text>
    <text x="140" y="195" text-anchor="middle" class="dim" fill="#FF6B6B">2 × seq × h × d</text>

    <!-- Attention -->
    <path d="M50,120 L120,230" class="arrow"/>
    <path d="M120,205 L120,230" class="arrow"/>
    <path d="M190,120 L120,230" class="arrow"/>

    <rect x="80" y="230" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="120" y="250" text-anchor="middle" class="label" fill="#000000">Attn</text>

    <!-- Output -->
    <path d="M120,260 L120,290" class="arrow"/>
    <rect x="80" y="290" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="120" y="310" text-anchor="middle" class="label" fill="#000000">Output</text>
  </g>

  <!-- MLA (right side) -->
  <g transform="translate(500, 100)">
    <text x="140" y="0" text-anchor="middle" class="label" fill="#83C167">MLA (DeepSeek-V2)</text>

    <!-- Input X -->
    <rect x="100" y="20" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="140" y="40" text-anchor="middle" class="label" fill="#000000">X</text>
    <text x="140" y="60" text-anchor="middle" class="dim">(seq, d_model)</text>

    <!-- Two projections: Q and compress -->
    <path d="M120,50 L60,90" class="arrow"/>
    <path d="M160,50 L200,90" class="arrow"/>

    <!-- Q projection -->
    <rect x="20" y="90" width="60" height="30" fill="#83C167" class="box" stroke="#83C167"/>
    <text x="50" y="110" text-anchor="middle" class="label" fill="#000000">Q</text>
    <text x="50" y="135" text-anchor="middle" class="dim">(seq, h×d)</text>

    <!-- Compress to latent -->
    <rect x="160" y="90" width="80" height="30" fill="#9B59B6" class="box" stroke="#9B59B6"/>
    <text x="200" y="110" text-anchor="middle" class="label" fill="#FFFFFF">c_KV</text>
    <text x="200" y="135" text-anchor="middle" class="dim">(seq, d_latent)</text>

    <!-- W_DKV label -->
    <text x="185" y="80" text-anchor="middle" class="math" fill="#9B59B6">W_DKV</text>

    <!-- Cache box (smaller!) -->
    <rect x="155" y="145" width="90" height="45" fill="none" stroke="#83C167" stroke-width="2" stroke-dasharray="5,3" rx="5"/>
    <text x="200" y="163" text-anchor="middle" class="label" fill="#83C167">Cache</text>
    <text x="200" y="180" text-anchor="middle" class="dim" fill="#83C167">seq × d_latent</text>

    <!-- Decompress to K, V -->
    <path d="M180,190 L140,230" class="arrow"/>
    <path d="M220,190 L260,230" class="arrow"/>

    <!-- K, V from decompression -->
    <rect x="110" y="230" width="60" height="30" fill="#FFFF00" class="box" stroke="#FFFF00"/>
    <text x="140" y="250" text-anchor="middle" class="label" fill="#000000">K</text>

    <rect x="230" y="230" width="60" height="30" fill="#FF9500" class="box" stroke="#FF9500"/>
    <text x="260" y="250" text-anchor="middle" class="label" fill="#000000">V</text>

    <!-- W_UK, W_UV labels -->
    <text x="145" y="220" text-anchor="middle" class="math" fill="#FFFF00">W_UK</text>
    <text x="255" y="220" text-anchor="middle" class="math" fill="#FF9500">W_UV</text>

    <!-- Attention -->
    <path d="M50,120 L140,290" class="arrow"/>
    <path d="M140,260 L140,290" class="arrow"/>
    <path d="M260,260 L160,290" class="arrow"/>

    <rect x="100" y="290" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="140" y="310" text-anchor="middle" class="label" fill="#000000">Attn</text>

    <!-- Output -->
    <path d="M140,320 L140,350" class="arrow"/>
    <rect x="100" y="350" width="80" height="30" fill="#29ABCA" class="box" stroke="#29ABCA"/>
    <text x="140" y="370" text-anchor="middle" class="label" fill="#000000">Output</text>
  </g>

  <!-- Comparison panel -->
  <g transform="translate(100, 440)">
    <rect x="0" y="0" width="700" height="90" fill="#111111" rx="5"/>

    <text x="350" y="25" text-anchor="middle" class="label">Memory Comparison (per layer, per token)</text>

    <!-- Standard MHA -->
    <text x="30" y="50" class="label" fill="#FF6B6B">Standard MHA:</text>
    <text x="150" y="50" class="math">2 × num_heads × head_dim</text>
    <text x="330" y="50" class="label" fill="#888888">= 2 × 32 × 128 = 8192</text>

    <!-- MLA -->
    <text x="30" y="75" class="label" fill="#83C167">MLA:</text>
    <text x="150" y="75" class="math">d_latent</text>
    <text x="330" y="75" class="label" fill="#888888">= 512</text>
    <text x="450" y="75" class="label" fill="#83C167">(16× smaller!)</text>
  </g>

  <!-- Key insight -->
  <g transform="translate(450, 400)">
    <text x="0" y="0" text-anchor="middle" class="subtitle">Key insight: Cache the compressed latent c_KV instead of full K, V</text>
    <text x="0" y="18" text-anchor="middle" class="subtitle">Decompress on-the-fly during attention computation</text>
  </g>
</svg>