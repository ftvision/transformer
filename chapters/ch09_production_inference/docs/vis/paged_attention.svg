<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550">
  <!-- Pure black background -->
  <rect width="900" height="550" fill="#000000"/>

  <!-- Title -->
  <text x="450" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">PagedAttention: Virtual Memory for KV-Cache</text>

  <!-- Subtitle -->
  <text x="450" y="60" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Allocate memory in blocks, on-demand — just like OS virtual memory
  </text>

  <!-- ============ Contiguous Allocation (Bad) ============ -->
  <g transform="translate(50, 100)">
    <text x="175" y="-10" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FF6B6B" text-anchor="middle">Contiguous Allocation</text>

    <!-- Request A -->
    <g transform="translate(0, 20)">
      <text x="-5" y="15" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="end">Req A:</text>
      <rect x="0" y="0" width="120" height="25" fill="#29ABCA" fill-opacity="0.6" stroke="#29ABCA" stroke-width="1"/>
      <rect x="120" y="0" width="230" height="25" fill="#29ABCA" fill-opacity="0.1" stroke="#444444" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="60" y="17" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">used</text>
      <text x="235" y="17" font-family="monospace" font-size="10" fill="#666666" text-anchor="middle">wasted</text>
    </g>

    <!-- Request B -->
    <g transform="translate(0, 55)">
      <text x="-5" y="15" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="end">Req B:</text>
      <rect x="0" y="0" width="40" height="25" fill="#FFFF00" fill-opacity="0.6" stroke="#FFFF00" stroke-width="1"/>
      <rect x="40" y="0" width="310" height="25" fill="#FFFF00" fill-opacity="0.1" stroke="#444444" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="20" y="17" font-family="monospace" font-size="10" fill="#FFFF00" text-anchor="middle">used</text>
      <text x="195" y="17" font-family="monospace" font-size="10" fill="#666666" text-anchor="middle">wasted</text>
    </g>

    <!-- Request C -->
    <g transform="translate(0, 90)">
      <text x="-5" y="15" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888" text-anchor="end">Req C:</text>
      <rect x="0" y="0" width="280" height="25" fill="#83C167" fill-opacity="0.6" stroke="#83C167" stroke-width="1"/>
      <rect x="280" y="0" width="70" height="25" fill="#83C167" fill-opacity="0.1" stroke="#444444" stroke-width="1" stroke-dasharray="4,2"/>
      <text x="140" y="17" font-family="monospace" font-size="10" fill="#83C167" text-anchor="middle">used</text>
    </g>

    <!-- Problem annotation -->
    <text x="175" y="145" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#FF6B6B" text-anchor="middle">Pre-allocate max length → huge waste</text>
  </g>

  <!-- ============ Paged Allocation (Good) ============ -->
  <g transform="translate(500, 100)">
    <text x="175" y="-10" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#83C167" text-anchor="middle">PagedAttention</text>

    <!-- Physical memory blocks -->
    <text x="0" y="25" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666">Physical blocks:</text>

    <g transform="translate(0, 35)">
      <!-- Block row 1 -->
      <rect x="0" y="0" width="40" height="30" fill="#29ABCA" fill-opacity="0.6" stroke="#29ABCA" stroke-width="1"/>
      <text x="20" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">A</text>

      <rect x="45" y="0" width="40" height="30" fill="#FFFF00" fill-opacity="0.6" stroke="#FFFF00" stroke-width="1"/>
      <text x="65" y="20" font-family="monospace" font-size="9" fill="#FFFF00" text-anchor="middle">B</text>

      <rect x="90" y="0" width="40" height="30" fill="#29ABCA" fill-opacity="0.6" stroke="#29ABCA" stroke-width="1"/>
      <text x="110" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">A</text>

      <rect x="135" y="0" width="40" height="30" fill="#83C167" fill-opacity="0.6" stroke="#83C167" stroke-width="1"/>
      <text x="155" y="20" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">C</text>

      <rect x="180" y="0" width="40" height="30" fill="#83C167" fill-opacity="0.6" stroke="#83C167" stroke-width="1"/>
      <text x="200" y="20" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">C</text>

      <rect x="225" y="0" width="40" height="30" fill="#29ABCA" fill-opacity="0.6" stroke="#29ABCA" stroke-width="1"/>
      <text x="245" y="20" font-family="monospace" font-size="9" fill="#29ABCA" text-anchor="middle">A</text>

      <rect x="270" y="0" width="40" height="30" fill="#83C167" fill-opacity="0.6" stroke="#83C167" stroke-width="1"/>
      <text x="290" y="20" font-family="monospace" font-size="9" fill="#83C167" text-anchor="middle">C</text>

      <rect x="315" y="0" width="40" height="30" fill="none" stroke="#444444" stroke-width="1" stroke-dasharray="3,2"/>
      <text x="335" y="20" font-family="monospace" font-size="9" fill="#444444" text-anchor="middle">free</text>
    </g>

    <!-- Block tables -->
    <g transform="translate(0, 90)">
      <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666">Block tables:</text>

      <text x="10" y="22" font-family="monospace" font-size="10" fill="#29ABCA">A: [0 → B0, 1 → B2, 2 → B5]</text>
      <text x="10" y="40" font-family="monospace" font-size="10" fill="#FFFF00">B: [0 → B1]</text>
      <text x="10" y="58" font-family="monospace" font-size="10" fill="#83C167">C: [0 → B3, 1 → B4, 2 → B6]</text>
    </g>

    <!-- Benefit annotation -->
    <text x="175" y="175" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#83C167" text-anchor="middle">Allocate on-demand → no waste</text>
  </g>

  <!-- ============ Memory Sharing Section ============ -->
  <g transform="translate(50, 310)">
    <text x="400" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#ffffff" text-anchor="middle">Memory Sharing: Shared Prefixes</text>

    <!-- Shared system prompt -->
    <g transform="translate(50, 30)">
      <text x="0" y="15" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#888888">System prompt (shared):</text>

      <!-- Shared blocks -->
      <g transform="translate(0, 25)">
        <rect x="0" y="0" width="60" height="35" fill="#9B59B6" fill-opacity="0.5" stroke="#9B59B6" stroke-width="2"/>
        <text x="30" y="22" font-family="monospace" font-size="10" fill="#9B59B6" text-anchor="middle">B0</text>

        <rect x="65" y="0" width="60" height="35" fill="#9B59B6" fill-opacity="0.5" stroke="#9B59B6" stroke-width="2"/>
        <text x="95" y="22" font-family="monospace" font-size="10" fill="#9B59B6" text-anchor="middle">B1</text>

        <rect x="130" y="0" width="60" height="35" fill="#9B59B6" fill-opacity="0.5" stroke="#9B59B6" stroke-width="2"/>
        <text x="160" y="22" font-family="monospace" font-size="10" fill="#9B59B6" text-anchor="middle">B2</text>
      </g>

      <!-- Arrows to requests -->
      <g transform="translate(95, 70)">
        <line x1="0" y1="0" x2="-60" y2="40" stroke="#9B59B6" stroke-width="1.5"/>
        <line x1="0" y1="0" x2="60" y2="40" stroke="#9B59B6" stroke-width="1.5"/>
      </g>

      <!-- Request 1 -->
      <g transform="translate(-30, 120)">
        <text x="50" y="0" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">Request 1</text>
        <rect x="0" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="32" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="64" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="96" y="10" width="30" height="25" fill="#29ABCA" fill-opacity="0.5" stroke="#29ABCA" stroke-width="1"/>
        <text x="15" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B0</text>
        <text x="47" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B1</text>
        <text x="79" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B2</text>
        <text x="111" y="27" font-family="monospace" font-size="8" fill="#29ABCA" text-anchor="middle">B5</text>
      </g>

      <!-- Request 2 -->
      <g transform="translate(120, 120)">
        <text x="50" y="0" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FFFF00" text-anchor="middle">Request 2</text>
        <rect x="0" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="32" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="64" y="10" width="30" height="25" fill="#9B59B6" fill-opacity="0.3" stroke="#9B59B6" stroke-width="1"/>
        <rect x="96" y="10" width="30" height="25" fill="#FFFF00" fill-opacity="0.5" stroke="#FFFF00" stroke-width="1"/>
        <text x="15" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B0</text>
        <text x="47" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B1</text>
        <text x="79" y="27" font-family="monospace" font-size="8" fill="#9B59B6" text-anchor="middle">B2</text>
        <text x="111" y="27" font-family="monospace" font-size="8" fill="#FFFF00" text-anchor="middle">B7</text>
      </g>
    </g>

    <!-- Memory savings callout -->
    <g transform="translate(500, 50)">
      <rect x="0" y="0" width="280" height="100" fill="#83C167" fill-opacity="0.1" stroke="#83C167" stroke-width="1" rx="5"/>
      <text x="140" y="25" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#83C167" text-anchor="middle">Memory Savings</text>
      <text x="20" y="50" font-family="monospace" font-size="11" fill="#888888">100 requests × 500 token prompt</text>
      <text x="20" y="70" font-family="monospace" font-size="11" fill="#FF6B6B">Without sharing: 50,000 tokens</text>
      <text x="20" y="90" font-family="monospace" font-size="11" fill="#83C167">With sharing:      500 tokens</text>
    </g>
  </g>

  <!-- Key insight box -->
  <g transform="translate(500, 480)">
    <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#29ABCA">Key insight:</text>
    <text x="100" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888">Blocks allocated only when needed, freed when done</text>
  </g>
</svg>