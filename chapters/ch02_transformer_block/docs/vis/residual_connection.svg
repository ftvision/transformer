<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520">
  <!-- Background -->
  <rect width="800" height="520" fill="#000000"/>

  <!-- Title -->
  <text x="400" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">Residual Connection: The Skip Highway</text>

  <!-- Subtitle -->
  <text x="400" y="60" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    output = layer(x) + x — gradients can flow through the skip path
  </text>

  <!-- ============ Without Residual (left) ============ -->
  <g transform="translate(100, 90)">
    <text x="100" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#888888" text-anchor="middle">Without Residual</text>

    <!-- Input -->
    <rect x="60" y="30" width="80" height="35" fill="none" stroke="#29ABCA" stroke-width="2"/>
    <text x="100" y="53" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#29ABCA" text-anchor="middle">x</text>

    <!-- Arrow down -->
    <line x1="100" y1="65" x2="100" y2="95" stroke="#666666" stroke-width="2"/>
    <polygon points="100,100 95,92 105,92" fill="#666666"/>

    <!-- Layer box -->
    <rect x="50" y="105" width="100" height="45" fill="#333333" stroke="#666666" stroke-width="2"/>
    <text x="100" y="133" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#ffffff" text-anchor="middle">Layer</text>

    <!-- Arrow down -->
    <line x1="100" y1="150" x2="100" y2="180" stroke="#666666" stroke-width="2"/>
    <polygon points="100,185 95,177 105,177" fill="#666666"/>

    <!-- Output -->
    <rect x="50" y="190" width="100" height="35" fill="none" stroke="#FC6255" stroke-width="2"/>
    <text x="100" y="213" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FC6255" text-anchor="middle">layer(x)</text>

    <!-- Gradient flow annotation -->
    <text x="100" y="250" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#666666" text-anchor="middle">Gradient must pass</text>
    <text x="100" y="267" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#666666" text-anchor="middle">through layer</text>
  </g>

  <!-- ============ With Residual (right) ============ -->
  <g transform="translate(450, 90)">
    <text x="125" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#83C167" text-anchor="middle">With Residual</text>

    <!-- Input -->
    <rect x="85" y="30" width="80" height="35" fill="none" stroke="#29ABCA" stroke-width="2"/>
    <text x="125" y="53" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#29ABCA" text-anchor="middle">x</text>

    <!-- Split point -->
    <circle cx="125" cy="80" r="4" fill="#29ABCA"/>

    <!-- Arrow down to layer -->
    <line x1="125" y1="65" x2="125" y2="75" stroke="#666666" stroke-width="2"/>
    <line x1="125" y1="84" x2="125" y2="100" stroke="#666666" stroke-width="2"/>
    <polygon points="125,105 120,97 130,97" fill="#666666"/>

    <!-- Skip connection (curved right) -->
    <path d="M 129 80 L 210 80 L 210 200 L 175 200" fill="none" stroke="#83C167" stroke-width="3" stroke-dasharray="8,4"/>
    <text x="225" y="140" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="start">skip</text>

    <!-- Layer box -->
    <rect x="75" y="110" width="100" height="45" fill="#333333" stroke="#666666" stroke-width="2"/>
    <text x="125" y="138" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#ffffff" text-anchor="middle">Layer</text>

    <!-- Arrow down from layer -->
    <line x1="125" y1="155" x2="125" y2="180" stroke="#666666" stroke-width="2"/>
    <polygon points="125,185 120,177 130,177" fill="#666666"/>

    <!-- Add circle -->
    <circle cx="125" cy="200" r="15" fill="none" stroke="#FFFF00" stroke-width="2"/>
    <text x="125" y="205" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#FFFF00" text-anchor="middle">+</text>

    <!-- Arrow down from add -->
    <line x1="125" y1="215" x2="125" y2="245" stroke="#666666" stroke-width="2"/>
    <polygon points="125,250 120,242 130,242" fill="#666666"/>

    <!-- Output -->
    <rect x="65" y="255" width="120" height="35" fill="none" stroke="#FC6255" stroke-width="2"/>
    <text x="125" y="278" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#FC6255" text-anchor="middle">layer(x) + x</text>
  </g>

  <!-- ============ Gradient Flow Box ============ -->
  <g transform="translate(50, 400)">
    <rect x="0" y="0" width="700" height="105" fill="none" stroke="#444444" stroke-width="1"/>
    <text x="350" y="25" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#ffffff" text-anchor="middle">Gradient Flow During Backpropagation</text>

    <!-- Without residual -->
    <g transform="translate(50, 50)">
      <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#888888" text-anchor="start">Without:</text>
      <text x="70" y="0" font-family="monospace" font-size="13" fill="#FC6255" text-anchor="start">∂L/∂x = ∂L/∂out × ∂layer/∂x</text>
      <text x="350" y="0" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#666666" text-anchor="start">← can vanish if ∂layer/∂x is small</text>
    </g>

    <!-- With residual -->
    <g transform="translate(50, 80)">
      <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#83C167" text-anchor="start">With:</text>
      <text x="70" y="0" font-family="monospace" font-size="13" fill="#83C167" text-anchor="start">∂L/∂x = ∂L/∂out × (∂layer/∂x + 1)</text>
      <text x="350" y="0" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="start">← always at least ∂L/∂out × 1</text>
    </g>
  </g>
</svg>
