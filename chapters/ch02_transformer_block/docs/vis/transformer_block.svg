<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 650">
  <!-- Background -->
  <rect width="700" height="650" fill="#000000"/>

  <!-- Title -->
  <text x="350" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">Complete Transformer Block</text>

  <!-- Subtitle -->
  <text x="350" y="58" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Pre-Norm Architecture (Modern Standard)
  </text>

  <!-- Main block diagram -->
  <g transform="translate(200, 90)">
    <!-- Input -->
    <rect x="75" y="0" width="150" height="35" fill="none" stroke="#29ABCA" stroke-width="2"/>
    <text x="150" y="23" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#29ABCA" text-anchor="middle">Input (seq_len, d_model)</text>

    <!-- Split point 1 -->
    <circle cx="150" cy="50" r="4" fill="#29ABCA"/>
    <line x1="150" y1="35" x2="150" y2="46" stroke="#666666" stroke-width="2"/>

    <!-- Skip connection 1 (right side) -->
    <path d="M 154 50 L 260 50 L 260 205" fill="none" stroke="#83C167" stroke-width="3"/>

    <!-- Arrow to LayerNorm 1 -->
    <line x1="150" y1="54" x2="150" y2="70" stroke="#666666" stroke-width="2"/>
    <polygon points="150,75 145,67 155,67" fill="#666666"/>

    <!-- LayerNorm 1 -->
    <rect x="75" y="80" width="150" height="32" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-width="2"/>
    <text x="150" y="101" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">LayerNorm</text>

    <!-- Arrow to Attention -->
    <line x1="150" y1="112" x2="150" y2="128" stroke="#666666" stroke-width="2"/>
    <polygon points="150,133 145,125 155,125" fill="#666666"/>

    <!-- Multi-Head Attention -->
    <rect x="50" y="138" width="200" height="45" fill="#333333" stroke="#FC6255" stroke-width="2"/>
    <text x="150" y="158" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#ffffff" text-anchor="middle">Multi-Head Attention</text>
    <text x="150" y="175" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="middle">(+ RoPE positions)</text>

    <!-- Arrow to Add 1 -->
    <line x1="150" y1="183" x2="150" y2="200" stroke="#666666" stroke-width="2"/>

    <!-- Add circle 1 -->
    <circle cx="150" cy="210" r="14" fill="none" stroke="#FFFF00" stroke-width="2"/>
    <text x="150" y="215" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FFFF00" text-anchor="middle">+</text>

    <!-- Skip connection meets Add 1 -->
    <line x1="260" y1="205" x2="260" y2="210" stroke="#83C167" stroke-width="3"/>
    <line x1="164" y1="210" x2="260" y2="210" stroke="#83C167" stroke-width="3"/>

    <!-- Arrow down from Add 1 -->
    <line x1="150" y1="224" x2="150" y2="250" stroke="#666666" stroke-width="2"/>

    <!-- Split point 2 -->
    <circle cx="150" cy="255" r="4" fill="#666666"/>

    <!-- Skip connection 2 (right side) -->
    <path d="M 154 255 L 260 255 L 260 410" fill="none" stroke="#83C167" stroke-width="3"/>

    <!-- Arrow to LayerNorm 2 -->
    <line x1="150" y1="259" x2="150" y2="275" stroke="#666666" stroke-width="2"/>
    <polygon points="150,280 145,272 155,272" fill="#666666"/>

    <!-- LayerNorm 2 -->
    <rect x="75" y="285" width="150" height="32" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-width="2"/>
    <text x="150" y="306" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">LayerNorm</text>

    <!-- Arrow to FFN -->
    <line x1="150" y1="317" x2="150" y2="333" stroke="#666666" stroke-width="2"/>
    <polygon points="150,338 145,330 155,330" fill="#666666"/>

    <!-- Feed-Forward Network -->
    <rect x="50" y="343" width="200" height="45" fill="#333333" stroke="#29ABCA" stroke-width="2"/>
    <text x="150" y="363" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#ffffff" text-anchor="middle">Feed-Forward Network</text>
    <text x="150" y="380" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="middle">(SwiGLU or GELU)</text>

    <!-- Arrow to Add 2 -->
    <line x1="150" y1="388" x2="150" y2="405" stroke="#666666" stroke-width="2"/>

    <!-- Add circle 2 -->
    <circle cx="150" cy="415" r="14" fill="none" stroke="#FFFF00" stroke-width="2"/>
    <text x="150" y="420" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FFFF00" text-anchor="middle">+</text>

    <!-- Skip connection meets Add 2 -->
    <line x1="260" y1="410" x2="260" y2="415" stroke="#83C167" stroke-width="3"/>
    <line x1="164" y1="415" x2="260" y2="415" stroke="#83C167" stroke-width="3"/>

    <!-- Arrow to output -->
    <line x1="150" y1="429" x2="150" y2="455" stroke="#666666" stroke-width="2"/>
    <polygon points="150,460 145,452 155,452" fill="#666666"/>

    <!-- Output -->
    <rect x="75" y="465" width="150" height="35" fill="none" stroke="#83C167" stroke-width="2"/>
    <text x="150" y="488" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#83C167" text-anchor="middle">Output (seq_len, d_model)</text>

    <!-- Residual labels -->
    <text x="280" y="130" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="start">residual</text>
    <text x="280" y="335" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="start">residual</text>
  </g>

  <!-- Bottom legend box -->
  <g transform="translate(80, 580)">
    <rect x="0" y="0" width="540" height="55" fill="none" stroke="#444444" stroke-width="1"/>
    <text x="270" y="18" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FFFF00" text-anchor="middle">Key Components</text>

    <circle cx="30" cy="40" r="6" fill="#83C167" fill-opacity="0.3" stroke="#83C167" stroke-width="1"/>
    <text x="45" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="start">LayerNorm (RMSNorm)</text>

    <rect x="175" y="34" width="12" height="12" fill="#333333" stroke="#FC6255" stroke-width="1"/>
    <text x="195" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="start">Attention</text>

    <rect x="270" y="34" width="12" height="12" fill="#333333" stroke="#29ABCA" stroke-width="1"/>
    <text x="290" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="start">FFN</text>

    <line x1="355" y1="40" x2="375" y2="40" stroke="#83C167" stroke-width="2"/>
    <text x="383" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="start">Residual</text>

    <circle cx="460" cy="40" r="8" fill="none" stroke="#FFFF00" stroke-width="1"/>
    <text x="460" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#FFFF00" text-anchor="middle">+</text>
    <text x="478" y="44" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#888888" text-anchor="start">Add</text>
  </g>
</svg>
