<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 520">
  <!-- Pure black background -->
  <rect width="800" height="520" fill="#000000"/>

  <!-- Title -->
  <text x="400" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">XLA Compilation Pipeline</text>

  <!-- Subtitle -->
  <text x="400" y="58" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    From high-level ops to optimized hardware code
  </text>

  <!-- ============ Pipeline Stages ============ -->

  <!-- Stage 1: Python Code -->
  <g transform="translate(100, 90)">
    <rect x="0" y="0" width="600" height="55" fill="#29ABCA" fill-opacity="0.15" stroke="#29ABCA" stroke-width="2" rx="8"/>
    <text x="300" y="25" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#29ABCA" text-anchor="middle">Python / JAX Code</text>
    <text x="300" y="45" font-family="monospace" font-size="11" fill="#888888" text-anchor="middle">y = jax.nn.softmax(x @ W, axis=-1)</text>
  </g>

  <!-- Arrow 1 -->
  <g transform="translate(400, 150)">
    <line x1="0" y1="0" x2="0" y2="25" stroke="#666666" stroke-width="2"/>
    <polygon points="0,25 -5,18 5,18" fill="#666666"/>
    <text x="60" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FFFF00">@jax.jit traces</text>
  </g>

  <!-- Stage 2: HLO (High Level Ops) -->
  <g transform="translate(100, 180)">
    <rect x="0" y="0" width="600" height="55" fill="#FFFF00" fill-opacity="0.1" stroke="#FFFF00" stroke-width="2" rx="8"/>
    <text x="300" y="25" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FFFF00" text-anchor="middle">HLO (High-Level Operations)</text>
    <text x="300" y="45" font-family="monospace" font-size="11" fill="#888888" text-anchor="middle">dot → reduce_max → subtract → exp → reduce_sum → divide</text>
  </g>

  <!-- Arrow 2 -->
  <g transform="translate(400, 240)">
    <line x1="0" y1="0" x2="0" y2="25" stroke="#666666" stroke-width="2"/>
    <polygon points="0,25 -5,18 5,18" fill="#666666"/>
    <text x="60" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167">Optimization passes</text>
  </g>

  <!-- Stage 3: Optimized HLO -->
  <g transform="translate(100, 270)">
    <rect x="0" y="0" width="600" height="70" fill="#83C167" fill-opacity="0.1" stroke="#83C167" stroke-width="2" rx="8"/>
    <text x="300" y="22" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#83C167" text-anchor="middle">Optimized HLO</text>

    <!-- Optimization highlights -->
    <g transform="translate(50, 35)">
      <text x="0" y="12" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888">• Op fusion</text>
      <text x="140" y="12" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888">• Constant folding</text>
      <text x="310" y="12" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888">• Memory planning</text>
      <text x="460" y="12" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888">• Layout opt</text>
    </g>
    <text x="300" y="60" font-family="monospace" font-size="11" fill="#83C167" text-anchor="middle">fused_softmax_dot(x, W)</text>
  </g>

  <!-- Arrow 3 -->
  <g transform="translate(400, 345)">
    <line x1="0" y1="0" x2="0" y2="25" stroke="#666666" stroke-width="2"/>
    <polygon points="0,25 -5,18 5,18" fill="#666666"/>
    <text x="60" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FF6B6B">Backend codegen</text>
  </g>

  <!-- Stage 4: Backend-Specific Code (split into 3) -->
  <g transform="translate(100, 375)">
    <!-- GPU Backend -->
    <g transform="translate(0, 0)">
      <rect x="0" y="0" width="180" height="60" fill="#FF6B6B" fill-opacity="0.15" stroke="#FF6B6B" stroke-width="2" rx="8"/>
      <text x="90" y="22" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">GPU (CUDA)</text>
      <text x="90" y="42" font-family="monospace" font-size="10" fill="#888888" text-anchor="middle">PTX → SASS binary</text>
    </g>

    <!-- TPU Backend -->
    <g transform="translate(210, 0)">
      <rect x="0" y="0" width="180" height="60" fill="#FF6B6B" fill-opacity="0.15" stroke="#FF6B6B" stroke-width="2" rx="8"/>
      <text x="90" y="22" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">TPU</text>
      <text x="90" y="42" font-family="monospace" font-size="10" fill="#888888" text-anchor="middle">TPU IR → binary</text>
    </g>

    <!-- CPU Backend -->
    <g transform="translate(420, 0)">
      <rect x="0" y="0" width="180" height="60" fill="#FF6B6B" fill-opacity="0.15" stroke="#FF6B6B" stroke-width="2" rx="8"/>
      <text x="90" y="22" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">CPU</text>
      <text x="90" y="42" font-family="monospace" font-size="10" fill="#888888" text-anchor="middle">LLVM → x86/ARM</text>
    </g>
  </g>

  <!-- ============ Key Insight ============ -->
  <g transform="translate(100, 460)">
    <rect x="0" y="0" width="600" height="45" fill="#ffffff" fill-opacity="0.05" stroke="#666666" stroke-width="1" rx="5"/>
    <text x="300" y="18" font-family="CMU Serif, Georgia, serif" font-size="13" fill="#ffffff" text-anchor="middle">First call compiles → Subsequent calls use cached binary</text>
    <text x="300" y="35" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="middle">Static shapes enable aggressive optimization — dynamic shapes cause recompilation</text>
  </g>
</svg>
