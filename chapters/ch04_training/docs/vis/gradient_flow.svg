<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 550">
  <!-- Pure black background -->
  <rect width="800" height="550" fill="#000000"/>

  <!-- Title -->
  <text x="400" y="35" font-family="CMU Serif, Georgia, serif" font-size="24" fill="#ffffff" text-anchor="middle">Gradient Flow Through Layers</text>

  <!-- Subtitle -->
  <text x="400" y="60" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Residual connections create a "gradient highway" for stable training
  </text>

  <!-- ============ Healthy Gradient Flow ============ -->
  <g transform="translate(50, 90)">
    <text x="150" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#83C167" text-anchor="middle">Healthy (with residuals)</text>

    <!-- Layers with gradient bars -->
    <g transform="translate(0, 25)">
      <!-- Layer 6 (output) -->
      <text x="-5" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 6</text>
      <rect x="0" y="0" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="0" width="180" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="15" font-family="monospace" font-size="10" fill="#83C167">0.10</text>

      <!-- Layer 5 -->
      <text x="-5" y="45" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 5</text>
      <rect x="0" y="30" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="30" width="170" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="45" font-family="monospace" font-size="10" fill="#83C167">0.09</text>

      <!-- Layer 4 -->
      <text x="-5" y="75" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 4</text>
      <rect x="0" y="60" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="60" width="190" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="75" font-family="monospace" font-size="10" fill="#83C167">0.11</text>

      <!-- Layer 3 -->
      <text x="-5" y="105" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 3</text>
      <rect x="0" y="90" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="90" width="180" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="105" font-family="monospace" font-size="10" fill="#83C167">0.10</text>

      <!-- Layer 2 -->
      <text x="-5" y="135" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 2</text>
      <rect x="0" y="120" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="120" width="175" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="135" font-family="monospace" font-size="10" fill="#83C167">0.10</text>

      <!-- Layer 1 (input) -->
      <text x="-5" y="165" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 1</text>
      <rect x="0" y="150" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="150" width="165" height="20" fill="#83C167" fill-opacity="0.7"/>
      <text x="210" y="165" font-family="monospace" font-size="10" fill="#83C167">0.09</text>
    </g>

    <!-- Arrow indicating gradient direction -->
    <g transform="translate(260, 50)">
      <line x1="0" y1="130" x2="0" y2="0" stroke="#83C167" stroke-width="2"/>
      <polygon points="0,0 -5,10 5,10" fill="#83C167"/>
      <text x="10" y="70" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167">∇</text>
    </g>

    <text x="150" y="210" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">Gradients stay stable!</text>
  </g>

  <!-- ============ Vanishing Gradients ============ -->
  <g transform="translate(400, 90)">
    <text x="150" y="0" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FF6B6B" text-anchor="middle">Vanishing (no residuals)</text>

    <!-- Layers with gradient bars -->
    <g transform="translate(0, 25)">
      <!-- Layer 6 (output) -->
      <text x="-5" y="15" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 6</text>
      <rect x="0" y="0" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="0" width="180" height="20" fill="#FFFF00" fill-opacity="0.7"/>
      <text x="210" y="15" font-family="monospace" font-size="10" fill="#FFFF00">0.10</text>

      <!-- Layer 5 -->
      <text x="-5" y="45" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 5</text>
      <rect x="0" y="30" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="30" width="90" height="20" fill="#FFFF00" fill-opacity="0.6"/>
      <text x="210" y="45" font-family="monospace" font-size="10" fill="#FFFF00">0.05</text>

      <!-- Layer 4 -->
      <text x="-5" y="75" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 4</text>
      <rect x="0" y="60" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="60" width="36" height="20" fill="#FF6B6B" fill-opacity="0.5"/>
      <text x="210" y="75" font-family="monospace" font-size="10" fill="#FF6B6B">0.02</text>

      <!-- Layer 3 -->
      <text x="-5" y="105" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 3</text>
      <rect x="0" y="90" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="90" width="10" height="20" fill="#FF6B6B" fill-opacity="0.4"/>
      <text x="210" y="105" font-family="monospace" font-size="10" fill="#FF6B6B">0.005</text>

      <!-- Layer 2 -->
      <text x="-5" y="135" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 2</text>
      <rect x="0" y="120" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="120" width="3" height="20" fill="#FF6B6B" fill-opacity="0.3"/>
      <text x="210" y="135" font-family="monospace" font-size="10" fill="#FF6B6B">0.001</text>

      <!-- Layer 1 (input) -->
      <text x="-5" y="165" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="end">Layer 1</text>
      <rect x="0" y="150" width="200" height="20" fill="#333333" stroke="#444444"/>
      <rect x="0" y="150" width="1" height="20" fill="#FF6B6B" fill-opacity="0.2"/>
      <text x="210" y="165" font-family="monospace" font-size="10" fill="#FF6B6B">≈0</text>
    </g>

    <!-- Arrow indicating gradient direction -->
    <g transform="translate(260, 50)">
      <line x1="0" y1="130" x2="0" y2="0" stroke="#FF6B6B" stroke-width="2" stroke-dasharray="5,3"/>
      <polygon points="0,0 -5,10 5,10" fill="#FF6B6B"/>
      <text x="10" y="70" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FF6B6B">∇→0</text>
    </g>

    <text x="150" y="210" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FF6B6B" text-anchor="middle">Early layers don't learn!</text>
  </g>

  <!-- ============ Residual Connection Diagram ============ -->
  <g transform="translate(100, 340)">
    <text x="300" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#ffffff" text-anchor="middle">The Residual Connection Trick</text>

    <!-- Without residual -->
    <g transform="translate(0, 30)">
      <text x="100" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">Without Residual</text>

      <!-- Blocks -->
      <rect x="50" y="20" width="100" height="30" fill="#333333" stroke="#FF6B6B" stroke-width="2"/>
      <text x="100" y="40" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#FF6B6B" text-anchor="middle">y = f(x)</text>

      <!-- Arrow down -->
      <line x1="100" y1="55" x2="100" y2="75" stroke="#888888" stroke-width="1"/>
      <polygon points="100,75 96,68 104,68" fill="#888888"/>

      <!-- Gradient path -->
      <text x="100" y="95" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="middle">∂y/∂x = ∂f/∂x</text>
      <text x="100" y="115" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#FF6B6B" text-anchor="middle">can vanish!</text>
    </g>

    <!-- With residual -->
    <g transform="translate(350, 30)">
      <text x="125" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#83C167" text-anchor="middle">With Residual</text>

      <!-- Input split -->
      <circle cx="125" cy="30" r="3" fill="#29ABCA"/>
      <text x="140" y="33" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#29ABCA">x</text>

      <!-- Skip connection (left) -->
      <line x1="125" y1="35" x2="125" y2="100" stroke="#83C167" stroke-width="2"/>
      <text x="110" y="70" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#83C167" text-anchor="end">identity</text>

      <!-- Transform path (right) -->
      <line x1="128" y1="30" x2="200" y2="30" stroke="#888888" stroke-width="1"/>
      <rect x="175" y="40" width="50" height="25" fill="#333333" stroke="#FFFF00" stroke-width="1"/>
      <text x="200" y="57" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#FFFF00" text-anchor="middle">f(x)</text>
      <line x1="200" y1="65" x2="200" y2="100" stroke="#888888" stroke-width="1"/>

      <!-- Add -->
      <circle cx="162" cy="100" r="10" fill="none" stroke="#83C167" stroke-width="2"/>
      <text x="162" y="104" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#83C167" text-anchor="middle">+</text>

      <!-- Output -->
      <line x1="162" y1="110" x2="162" y2="130" stroke="#888888" stroke-width="1"/>
      <polygon points="162,130 158,123 166,123" fill="#888888"/>

      <!-- Gradient explanation -->
      <text x="125" y="155" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#888888" text-anchor="middle">∂y/∂x = 1 + ∂f/∂x</text>
      <text x="125" y="175" font-family="CMU Serif, Georgia, serif" font-size="10" fill="#83C167" text-anchor="middle">always ≥ 1!</text>
    </g>
  </g>

  <!-- Key insight -->
  <g transform="translate(50, 510)">
    <text x="350" y="0" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FFFF00" text-anchor="middle">
      Key insight: The "1" in (1 + ∂f/∂x) guarantees gradients flow through, even if ∂f/∂x → 0
    </text>
  </g>
</svg>
