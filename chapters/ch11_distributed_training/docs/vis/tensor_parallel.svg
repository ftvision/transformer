<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <!-- Pure black background -->
  <rect width="900" height="600" fill="#000000"/>

  <!-- Title -->
  <text x="450" y="40" font-family="CMU Serif, Georgia, serif" font-size="26" fill="#ffffff" text-anchor="middle">Tensor Parallelism: Splitting Layers</text>

  <!-- Subtitle -->
  <text x="450" y="68" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#888888" text-anchor="middle">
    Column-parallel first layer + Row-parallel second layer = minimal communication
  </text>

  <!-- ============ MLP Tensor Parallelism ============ -->
  <g transform="translate(50, 100)">
    <text x="200" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#FFFF00" text-anchor="middle">MLP: GELU(XW₁)W₂</text>

    <!-- Input X -->
    <g transform="translate(80, 30)">
      <rect x="0" y="0" width="240" height="40" rx="4" fill="#888888" fill-opacity="0.2" stroke="#888888" stroke-width="2"/>
      <text x="120" y="26" font-family="monospace" font-size="14" fill="#888888" text-anchor="middle">X (batch, hidden)</text>
      <text x="120" y="55" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#666666" text-anchor="middle">replicated on both GPUs</text>
    </g>

    <!-- Split arrow -->
    <g transform="translate(200, 90)">
      <line x1="0" y1="0" x2="-80" y2="35" stroke="#FFFF00" stroke-width="2"/>
      <line x1="0" y1="0" x2="80" y2="35" stroke="#FFFF00" stroke-width="2"/>
      <polygon points="-80,35 -73,28 -71,35" fill="#FFFF00"/>
      <polygon points="80,35 73,28 71,35" fill="#FFFF00"/>
    </g>

    <!-- First Linear Layer - Column Parallel -->
    <g transform="translate(0, 130)">
      <text x="200" y="-5" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#29ABCA" text-anchor="middle">Column-Parallel: XW₁</text>

      <!-- GPU 0 -->
      <rect x="30" y="10" width="150" height="70" rx="4" fill="none" stroke="#29ABCA" stroke-width="2"/>
      <text x="105" y="30" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA" text-anchor="middle">GPU 0</text>
      <rect x="40" y="38" width="130" height="35" rx="2" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="105" y="60" font-family="monospace" font-size="11" fill="#29ABCA" text-anchor="middle">W₁[:, :n/2]</text>

      <!-- GPU 1 -->
      <rect x="220" y="10" width="150" height="70" rx="4" fill="none" stroke="#29ABCA" stroke-width="2"/>
      <text x="295" y="30" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA" text-anchor="middle">GPU 1</text>
      <rect x="230" y="38" width="130" height="35" rx="2" fill="#29ABCA" fill-opacity="0.3" stroke="#29ABCA"/>
      <text x="295" y="60" font-family="monospace" font-size="11" fill="#29ABCA" text-anchor="middle">W₁[:, n/2:]</text>

      <!-- No communication badge -->
      <rect x="165" y="40" width="70" height="20" rx="10" fill="#83C167" fill-opacity="0.3" stroke="#83C167"/>
      <text x="200" y="54" font-family="CMU Serif, Georgia, serif" font-size="9" fill="#83C167" text-anchor="middle">No comm!</text>
    </g>

    <!-- Arrows down -->
    <line x1="105" y1="210" x2="105" y2="230" stroke="#666666" stroke-width="1.5"/>
    <line x1="295" y1="210" x2="295" y2="230" stroke="#666666" stroke-width="1.5"/>

    <!-- GELU -->
    <g transform="translate(0, 235)">
      <rect x="50" y="0" width="110" height="30" rx="2" fill="#FFFF00" fill-opacity="0.2" stroke="#FFFF00"/>
      <text x="105" y="20" font-family="monospace" font-size="11" fill="#FFFF00" text-anchor="middle">GELU(Y₀)</text>

      <rect x="240" y="0" width="110" height="30" rx="2" fill="#FFFF00" fill-opacity="0.2" stroke="#FFFF00"/>
      <text x="295" y="20" font-family="monospace" font-size="11" fill="#FFFF00" text-anchor="middle">GELU(Y₁)</text>
    </g>

    <!-- Arrows down -->
    <line x1="105" y1="270" x2="105" y2="290" stroke="#666666" stroke-width="1.5"/>
    <line x1="295" y1="270" x2="295" y2="290" stroke="#666666" stroke-width="1.5"/>

    <!-- Second Linear Layer - Row Parallel -->
    <g transform="translate(0, 295)">
      <text x="200" y="-5" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#FF6B6B" text-anchor="middle">Row-Parallel: Y·W₂</text>

      <!-- GPU 0 -->
      <rect x="30" y="10" width="150" height="70" rx="4" fill="none" stroke="#FF6B6B" stroke-width="2"/>
      <text x="105" y="30" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FF6B6B" text-anchor="middle">GPU 0</text>
      <rect x="40" y="38" width="130" height="35" rx="2" fill="#FF6B6B" fill-opacity="0.3" stroke="#FF6B6B"/>
      <text x="105" y="60" font-family="monospace" font-size="11" fill="#FF6B6B" text-anchor="middle">W₂[:n/2, :]</text>

      <!-- GPU 1 -->
      <rect x="220" y="10" width="150" height="70" rx="4" fill="none" stroke="#FF6B6B" stroke-width="2"/>
      <text x="295" y="30" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FF6B6B" text-anchor="middle">GPU 1</text>
      <rect x="230" y="38" width="130" height="35" rx="2" fill="#FF6B6B" fill-opacity="0.3" stroke="#FF6B6B"/>
      <text x="295" y="60" font-family="monospace" font-size="11" fill="#FF6B6B" text-anchor="middle">W₂[n/2:, :]</text>
    </g>

    <!-- Merge arrows -->
    <g transform="translate(200, 380)">
      <line x1="-95" y1="0" x2="0" y2="25" stroke="#83C167" stroke-width="2"/>
      <line x1="95" y1="0" x2="0" y2="25" stroke="#83C167" stroke-width="2"/>
    </g>

    <!-- All-Reduce -->
    <g transform="translate(115, 410)">
      <rect x="0" y="0" width="170" height="35" rx="4" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-width="2"/>
      <text x="85" y="22" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#83C167" text-anchor="middle">All-Reduce (sum)</text>
    </g>

    <!-- Output -->
    <g transform="translate(80, 460)">
      <rect x="0" y="0" width="240" height="35" rx="4" fill="#888888" fill-opacity="0.2" stroke="#888888" stroke-width="2"/>
      <text x="120" y="22" font-family="monospace" font-size="12" fill="#888888" text-anchor="middle">Output (replicated)</text>
    </g>
  </g>

  <!-- ============ Key Insight Box ============ -->
  <g transform="translate(480, 100)">
    <rect x="0" y="0" width="370" height="180" rx="6" fill="#222222" stroke="#FFFF00" stroke-width="1"/>
    <text x="185" y="28" font-family="CMU Serif, Georgia, serif" font-size="16" fill="#FFFF00" text-anchor="middle">Key Insight: Why This Works</text>

    <g transform="translate(20, 50)">
      <text x="0" y="0" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA">Column split on W₁:</text>
      <text x="10" y="20" font-family="monospace" font-size="11" fill="#888888">X @ W₁[:,:n/2] → Y₀   (no X split needed)</text>
      <text x="10" y="38" font-family="monospace" font-size="11" fill="#888888">X @ W₁[:,n/2:] → Y₁</text>

      <text x="0" y="65" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FF6B6B">Row split on W₂:</text>
      <text x="10" y="85" font-family="monospace" font-size="11" fill="#888888">Y₀ @ W₂[:n/2,:] → Z₀</text>
      <text x="10" y="103" font-family="monospace" font-size="11" fill="#888888">Y₁ @ W₂[n/2:,:] → Z₁</text>
      <text x="10" y="121" font-family="monospace" font-size="11" fill="#83C167">Z = Z₀ + Z₁   (all-reduce)</text>
    </g>
  </g>

  <!-- ============ Attention Split ============ -->
  <g transform="translate(480, 300)">
    <text x="185" y="0" font-family="CMU Serif, Georgia, serif" font-size="18" fill="#29ABCA" text-anchor="middle">Attention: Split by Heads</text>

    <g transform="translate(0, 25)">
      <!-- Input -->
      <rect x="100" y="0" width="170" height="30" rx="2" fill="#888888" fill-opacity="0.2" stroke="#888888"/>
      <text x="185" y="20" font-family="monospace" font-size="11" fill="#888888" text-anchor="middle">Input (replicated)</text>

      <!-- Split to heads -->
      <line x1="145" y1="30" x2="80" y2="55" stroke="#29ABCA" stroke-width="1.5"/>
      <line x1="225" y1="30" x2="290" y2="55" stroke="#29ABCA" stroke-width="1.5"/>

      <!-- GPU boxes with heads -->
      <rect x="10" y="55" width="140" height="80" rx="4" fill="none" stroke="#29ABCA" stroke-width="2"/>
      <text x="80" y="75" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">GPU 0</text>
      <rect x="20" y="82" width="120" height="20" rx="2" fill="#FFFF00" fill-opacity="0.2" stroke="#FFFF00"/>
      <text x="80" y="97" font-family="monospace" font-size="10" fill="#FFFF00" text-anchor="middle">Heads 0,1,2,3</text>
      <rect x="20" y="107" width="120" height="20" rx="2" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA"/>
      <text x="80" y="122" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">Q₀,K₀,V₀ proj</text>

      <rect x="220" y="55" width="140" height="80" rx="4" fill="none" stroke="#29ABCA" stroke-width="2"/>
      <text x="290" y="75" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#29ABCA" text-anchor="middle">GPU 1</text>
      <rect x="230" y="82" width="120" height="20" rx="2" fill="#FFFF00" fill-opacity="0.2" stroke="#FFFF00"/>
      <text x="290" y="97" font-family="monospace" font-size="10" fill="#FFFF00" text-anchor="middle">Heads 4,5,6,7</text>
      <rect x="230" y="107" width="120" height="20" rx="2" fill="#29ABCA" fill-opacity="0.2" stroke="#29ABCA"/>
      <text x="290" y="122" font-family="monospace" font-size="10" fill="#29ABCA" text-anchor="middle">Q₁,K₁,V₁ proj</text>

      <!-- Merge -->
      <line x1="80" y1="135" x2="145" y2="160" stroke="#83C167" stroke-width="1.5"/>
      <line x1="290" y1="135" x2="225" y2="160" stroke="#83C167" stroke-width="1.5"/>

      <!-- All-reduce -->
      <rect x="100" y="160" width="170" height="30" rx="2" fill="#83C167" fill-opacity="0.2" stroke="#83C167" stroke-width="2"/>
      <text x="185" y="180" font-family="CMU Serif, Georgia, serif" font-size="11" fill="#83C167" text-anchor="middle">All-Reduce after O proj</text>
    </g>
  </g>

  <!-- ============ Communication Summary ============ -->
  <g transform="translate(50, 530)">
    <rect x="0" y="0" width="800" height="50" rx="4" fill="#333333"/>

    <text x="400" y="18" font-family="CMU Serif, Georgia, serif" font-size="14" fill="#ffffff" text-anchor="middle">Communication per Transformer Block with Tensor Parallelism</text>

    <text x="150" y="40" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA" text-anchor="middle">MLP: 1 all-reduce</text>
    <text x="400" y="40" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#29ABCA" text-anchor="middle">Attention: 1 all-reduce</text>
    <text x="650" y="40" font-family="CMU Serif, Georgia, serif" font-size="12" fill="#FFFF00" text-anchor="middle">Total: 2 all-reduces per block</text>
  </g>
</svg>